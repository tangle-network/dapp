// {
//   "operatorId": "5FLSigC9HGRKVhB9FiEo4Y3koPsNmBmLJbpXg2mp1hXcS59Y",
//   "first": 10,
//   "offset": 0
// }

// Query Registered Blueprints
query GetBlueprintOperatorsByOperatorId($operatorId: String!, $first: Int, $offset: Int) {
  blueprintOperators(
    filter: {
      operator: { id: { equalTo: $operatorId } }
      isActive: { equalTo: true }
    }
    first: $first
    offset: $offset
  ) {
    nodes {
      blueprintId
      blueprint {
        # Count the number of operator
        blueprintOperatorsAggregate: blueprintOperators {
          totalCount
        }
        # Count of services
        servicesAggregate: services {
          totalCount
        }
      }
      operatorId
      registeredAt
      isActive
    }
    pageInfo {
      hasPreviousPage
      hasNextPage
    }
    totalCount
  }
}


// Query Running Instances
query GetRunningServicesByOperator($operatorId: String!, $first: Int, $offset: Int) {
  services(
    filter: { 
      serviceRequest: { 
        serviceRequestOperators: { 
          some: { operator: { id: { equalTo: $operatorId } } } 
        } 
      },
      terminatedAt: { isNull: true } 
    },
    first: $first,
    offset: $offset
  ) {
    nodes {
      id
      serviceRequestId
      ownerId
      blueprintId
      assetSecurityCommitments
      createdAt
      terminatedAt
    }
    pageInfo {
      hasPreviousPage
      hasNextPage
    }
    totalCount
  }
}


// Query Pending Instance
query GetPendingServiceRequestOperatorsByOperatorId($operatorId: String!, $first: Int, $offset: Int) {
  serviceRequestOperators(
    filter: { 
      operator: { id: { equalTo: $operatorId } }
      and: {
        approvedAt:{ isNull:true }
        rejectedAt: { isNull:true }
      }
    }
    first: $first
    offset: $offset
  ) {
    nodes {
      id
      serviceRequest {
        ownerId
        assetSecurityRequirements
      }
      serviceRequestId
      operatorId
      createdAt
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
    }
    totalCount
  }
}


// Query Stopped Instance
query GetStoppedServicesByOperator($operatorId: String!, $first: Int, $offset: Int) {
  services(
    filter: { 
      serviceRequest: { 
        serviceRequestOperators: { 
          some: { operator: { id: { equalTo: $operatorId } } } 
        } 
      },
      terminatedAt: { isNull: false } 
    },
    first: $first,
    offset: $offset
  ) {
    nodes {
      id
      serviceRequestId
      ownerId
      blueprintId
      assetSecurityCommitments
      createdAt
      terminatedAt
    }
    pageInfo {
      hasPreviousPage
      hasNextPage
    }
    totalCount
  }
}