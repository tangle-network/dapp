import{r as a}from"./index-C6mWTJJr.js";const u=new Map;function E(e,r){const c=r==null?void 0:r.serializer,[l]=a.useState(r==null?void 0:r.defaultValue),[g]=a.useState(r==null?void 0:r.defaultServerValue);return h(e,l,g,r==null?void 0:r.storageSync,c==null?void 0:c.parse,c==null?void 0:c.stringify)}function h(e,r,c,l=!0,g=I,o=JSON.stringify){const s=a.useRef({string:null,parsed:void 0}),f=a.useSyncExternalStore(a.useCallback(n=>{const t=b=>{e===b&&n()};return m.add(t),()=>{m.delete(t)}},[e]),()=>{const n=d(()=>localStorage.getItem(e))??null;if(u.has(e))s.current.parsed=u.get(e);else if(n!==s.current.string){let t;try{t=n===null?r:g(n)}catch{t=r}s.current.parsed=t}return s.current.string=n,r!==void 0&&n===null&&d(()=>{const t=o(r);localStorage.setItem(e,t),s.current={string:t,parsed:r}}),s.current.parsed},()=>c??r),i=a.useCallback(n=>{const t=n instanceof Function?n(s.current.parsed):n;try{localStorage.setItem(e,o(t)),u.delete(e)}catch{u.set(e,t)}S(e)},[e,o]),v=a.useCallback(()=>{d(()=>localStorage.removeItem(e)),u.delete(e),S(e)},[e]);return a.useEffect(()=>{if(!l)return;const n=t=>{t.key===e&&t.storageArea===d(()=>localStorage)&&S(e)};return window.addEventListener("storage",n),()=>window.removeEventListener("storage",n)},[e,l]),a.useMemo(()=>[f,i,{isPersistent:f===r||!u.has(e),removeItem:v}],[e,i,f,r,v])}const m=new Set;function S(e){for(const r of[...m])r(e)}function I(e){return e==="undefined"?void 0:JSON.parse(e)}function d(e){try{return e()}catch{}}export{E as u};
